<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Futures Trading Journal (Offline)</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f1620;
      --panel2:#0c121b;
      --text:#e7eef8;
      --muted:#9fb0c7;
      --line:#1b2736;
      --accent:#56b6ff;
      --good:#2ee59d;
      --bad:#ff5f6d;
      --warn:#ffcc66;
      --chip:#0b1b2b;
      --shadow: 0 8px 22px rgba(0,0,0,.45);
      --radius: 14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--sans);
      background: radial-gradient(1200px 700px at 15% 10%, rgba(86,182,255,.12), transparent 55%),
                  radial-gradient(900px 600px at 85% 30%, rgba(46,229,157,.10), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1200px; margin:0 auto; padding:18px}
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      padding:14px; background: rgba(15,22,32,.78); border:1px solid var(--line);
      border-radius: var(--radius); box-shadow: var(--shadow); backdrop-filter: blur(8px);
      position:sticky; top:10px; z-index:5;
    }
    .brand{display:flex; flex-direction:column; gap:4px}
    .brand h1{margin:0; font-size:16px; letter-spacing:.2px}
    .brand .sub{color:var(--muted); font-size:12px}
    .actions{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    button{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(17,27,41,.95), rgba(12,18,27,.95));
      color:var(--text);
      padding:10px 12px; border-radius:12px; cursor:pointer;
      box-shadow: 0 6px 16px rgba(0,0,0,.35);
      font-weight:600; font-size:13px;
    }
    button:hover{border-color: rgba(86,182,255,.45)}
    button.primary{
      border-color: rgba(86,182,255,.55);
      background: linear-gradient(180deg, rgba(86,182,255,.18), rgba(12,18,27,.95));
    }
    button.danger{
      border-color: rgba(255,95,109,.55);
      background: linear-gradient(180deg, rgba(255,95,109,.14), rgba(12,18,27,.95));
    }
    button.ghost{background: transparent; box-shadow:none;}
    .pill{
      font-family: var(--mono);
      background: rgba(11,27,43,.65); border:1px solid var(--line);
      padding:7px 10px; border-radius:999px; font-size:12px; color:var(--muted);
    }

    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1.08fr .92fr;
      gap:14px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr}
      .topbar{position:static}
    }

    .card{
      background: rgba(15,22,32,.78);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:12px 14px; border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
      background: rgba(12,18,27,.65);
    }
    .card .hd .title{font-weight:800; font-size:13px; letter-spacing:.2px}
    .card .bd{padding:14px}

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-bottom:10px;
    }
    @media (max-width: 560px){
      .row{grid-template-columns:1fr}
    }
    label{display:flex; flex-direction:column; gap:6px; font-size:12px; color:var(--muted)}
    input, select, textarea{
      width:100%;
      background: rgba(10,16,24,.85);
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 10px;
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(86,182,255,.6);
      box-shadow: 0 0 0 3px rgba(86,182,255,.12);
    }
    textarea{min-height:120px; resize:vertical}
    .seg{display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(11,27,43,.55);
      font-size:12px; color:var(--muted);
      font-family: var(--mono);
      user-select:none;
    }
    .chip b{color:var(--text); font-family:var(--sans)}
    .kpis{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }
    @media (max-width: 980px){
      .kpis{grid-template-columns: repeat(2, 1fr)}
    }
    .kpi{
      padding:12px; border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(11,18,27,.65);
    }
    .kpi .k{color:var(--muted); font-size:12px}
    .kpi .v{font-size:18px; font-weight:900; margin-top:6px; font-family:var(--mono)}
    .kpi .v.good{color:var(--good)}
    .kpi .v.bad{color:var(--bad)}
    .kpi .v.warn{color:var(--warn)}

    .tableWrap{
      width:100%;
      overflow:auto;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(11,18,27,.55);
    }
    table{
      width:100%;
      border-collapse:collapse;
      min-width: 980px;
    }
    th, td{
      padding:10px 10px;
      border-bottom:1px solid rgba(27,39,54,.75);
      text-align:left;
      font-size:12px;
      vertical-align:top;
      white-space:nowrap;
    }
    th{color:var(--muted); font-weight:800; background: rgba(12,18,27,.65)}
    tr:hover td{background: rgba(86,182,255,.05)}
    .tag{
      font-family: var(--mono);
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(11,27,43,.55);
      color: var(--muted);
      display:inline-flex; align-items:center; gap:6px;
    }
    .tag.good{color: var(--good); border-color: rgba(46,229,157,.35)}
    .tag.bad{color: var(--bad); border-color: rgba(255,95,109,.35)}
    .tag.warn{color: var(--warn); border-color: rgba(255,204,102,.35)}
    .miniBtns{display:flex; gap:6px; align-items:center}
    .miniBtns button{padding:7px 9px; border-radius:10px; font-size:12px}
    .notePreview{max-width:220px; overflow:hidden; text-overflow:ellipsis; color: var(--muted);}

    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.6);
      display:none; align-items:center; justify-content:center;
      padding:18px; z-index:20;
    }
    .modal{
      max-width: 900px; width:100%;
      background: rgba(15,22,32,.92);
      border:1px solid var(--line);
      border-radius: 18px;
      box-shadow: 0 20px 70px rgba(0,0,0,.6);
      overflow:hidden;
    }
    .modal .mhd{
      padding:12px 14px; border-bottom:1px solid var(--line);
      display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
      background: rgba(12,18,27,.75);
    }
    .modal .mbd{padding:14px}
    .modal pre{
      white-space:pre-wrap; margin:0;
      background: rgba(10,16,24,.85);
      border:1px solid var(--line);
      padding:12px; border-radius:12px;
      color: var(--text);
      font-family: var(--mono);
      font-size:12px;
    }

    .authScreen{min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px;}
    .authBox{
      width:100%;
      max-width:560px;
      background: rgba(15,22,32,.86);
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .authBox .hd{padding:14px 16px; border-bottom:1px solid var(--line); background: rgba(12,18,27,.65);}
    .authBox .hd h2{margin:0; font-size:16px}
    .authBox .hd p{margin:6px 0 0; color:var(--muted); font-size:12px}
    .authBox .bd{padding:16px}
    .hint{
      margin-top:10px;
      padding:10px 12px;
      background: rgba(11,27,43,.55);
      border:1px solid var(--line);
      border-radius: 14px;
      color: var(--muted);
      font-size:12px;
      line-height:1.45;
    }
    .error{
      margin-top:10px; padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,95,109,.35);
      background: rgba(255,95,109,.10);
      color: #ffd6da;
      font-size:12px;
      display:none;
      white-space:pre-line;
    }
    .ok{
      margin-top:10px; padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(46,229,157,.35);
      background: rgba(46,229,157,.10);
      color: #d8ffef;
      font-size:12px;
      display:none;
      white-space:pre-line;
    }
    .footerNote{margin-top:14px; color: var(--muted); font-size:12px; line-height:1.45;}
    .muted{color:var(--muted)}
    .mono{font-family: var(--mono)}
  </style>
</head>

<body>
<!-- AUTH -->
<section id="auth" class="authScreen">
  <div class="authBox">
    <div class="hd">
      <h2>üîê Trading Journal ‚Äî Unlock</h2>
      <p>Offline (local). Data per-user disimpan terenkripsi di browser kamu.</p>
    </div>
    <div class="bd">
      <div class="row">
        <label>
          Clue / Inisial (username)
          <input id="authUser" placeholder="misal: NUUS / BROTRADER" autocomplete="username" />
        </label>
        <label>
          Password
          <input id="authPass" type="password" placeholder="password" autocomplete="current-password" />
        </label>
      </div>

      <div class="row">
        <label>
          Mode
          <select id="authMode">
            <option value="auto">Auto (Create kalau belum ada, Unlock kalau sudah ada)</option>
            <option value="create">Create new vault</option>
            <option value="unlock">Unlock existing vault</option>
          </select>
        </label>

        <label>
          (Opsional) Import file saat unlock
          <input id="authImport" type="file" accept=".json,application/json" />
        </label>
      </div>

      <div class="seg">
        <button class="primary" id="btnAuth">Unlock</button>
        <button class="ghost" id="btnAuthClear">Reset input</button>
      </div>

      <div class="error" id="authErr"></div>
      <div class="ok" id="authOk"></div>

      <div class="hint">
        <b>Catatan penting:</b><br/>
        ‚Ä¢ Kalau kamu belum pernah bikin user, pilih <span class="mono">Auto</span> lalu klik <b>Unlock</b> ‚Üí dia akan otomatis <b>Create</b> vault baru.<br/>
        ‚Ä¢ Kalau kamu mau pindah device: lakukan <b>Export</b> di device lama ‚Üí <b>Import</b> di device baru ‚Üí unlock pakai clue+pw yang sama.<br/><br/>
        <b>Wajib:</b> buka lewat <span class="mono">HTTPS</span> (GitHub Pages) atau <span class="mono">localhost</span>. Kalau buka <span class="mono">file://</span>, fitur encrypt bisa gagal.
      </div>

      <div class="footerNote">
        Ini web static, jadi <b>tidak ada cloud sync otomatis</b>. Tapi data bisa dipindah dengan export/import.
        Semua perhitungan di sini adalah estimasi sederhana (belum termasuk fee/funding/slippage).
      </div>
    </div>
  </div>
</section>

<!-- APP -->
<section id="app" style="display:none;">
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <h1>üìí Futures Trading Journal</h1>
        <div class="sub">Real-time calc ‚Ä¢ Offline ‚Ä¢ Dark mode ‚Ä¢ Export/Import</div>
      </div>

      <div class="actions">
        <div class="pill">User: <span id="who" class="mono"></span></div>
        <button id="btnExport" class="primary">Export JSON</button>
        <button id="btnImport" class="">Import JSON</button>
        <input id="fileImport" type="file" accept=".json,application/json" style="display:none;">
        <button id="btnLock" class="danger">Lock</button>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: FORM -->
      <div class="card">
        <div class="hd">
          <div class="title">1) Setup Trade (Auto Calculation)</div>
          <div class="seg">
            <button id="btnNew" class="primary">+ New Trade</button>
            <span class="chip"><b>Mode</b> <span id="modeLabel">Create</span></span>
          </div>
        </div>

        <div class="bd">
          <div class="row">
            <label>Date & time
              <input id="f_dt" type="datetime-local" />
            </label>
            <label>Pair / Asset
              <input id="f_pair" placeholder="BTCUSDT / ETHUSDT / dll" />
            </label>
          </div>

          <div class="row">
            <label>Position type
              <select id="f_side">
                <option value="LONG">Long</option>
                <option value="SHORT">Short</option>
              </select>
            </label>
            <label>Entry price
              <input id="f_entry" type="number" step="0.00000001" placeholder="e.g. 100000" />
            </label>
          </div>

          <div class="row">
            <label>Margin (USDT)
              <input id="f_margin" type="number" step="0.01" placeholder="e.g. 50" />
            </label>
            <label>Leverage (x)
              <input id="f_lev" type="number" step="0.1" placeholder="e.g. 40" />
            </label>
          </div>

          <div class="card" style="margin-top:10px;">
            <div class="hd">
              <div class="title">2) SL / TP Dual Mode</div>
              <div class="seg"><span class="tag warn">Tip: isi salah satu ‚Üí yang lain auto</span></div>
            </div>
            <div class="bd">
              <div class="row">
                <label>Stop Loss % (e.g. 0.3)
                  <input id="f_sl_pct" type="number" step="0.0001" placeholder="0.3" />
                </label>
                <label>Stop Loss price
                  <input id="f_sl_price" type="number" step="0.00000001" placeholder="auto" />
                </label>
              </div>

              <div class="row">
                <label>Take Profit % (e.g. 1.2)
                  <input id="f_tp_pct" type="number" step="0.0001" placeholder="1.2" />
                </label>
                <label>Take Profit price
                  <input id="f_tp_price" type="number" step="0.00000001" placeholder="auto" />
                </label>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top:10px;">
            <div class="hd">
              <div class="title">3) Real-time Output (Fokus Angka)</div>
              <div class="seg"><span class="tag" id="calcBadge">‚Äî</span></div>
            </div>
            <div class="bd">
              <div class="kpis">
                <div class="kpi">
                  <div class="k">Position size (margin √ó lev)</div>
                  <div class="v" id="o_pos">‚Äî</div>
                </div>
                <div class="kpi">
                  <div class="k">SL impact to margin</div>
                  <div class="v bad" id="o_sl_imp">‚Äî</div>
                </div>
                <div class="kpi">
                  <div class="k">TP impact to margin</div>
                  <div class="v good" id="o_tp_imp">‚Äî</div>
                </div>
                <div class="kpi">
                  <div class="k">RR (TP% / SL%)</div>
                  <div class="v warn" id="o_rr">‚Äî</div>
                </div>
              </div>

              <div class="row" style="margin-top:10px;">
                <div class="kpi">
                  <div class="k">SL price</div>
                  <div class="v bad" id="o_sl_price">‚Äî</div>
                  <div class="k" style="margin-top:6px;">Est. Loss (USDT)</div>
                  <div class="v bad" id="o_sl_pnl">‚Äî</div>
                </div>
                <div class="kpi">
                  <div class="k">TP price</div>
                  <div class="v good" id="o_tp_price">‚Äî</div>
                  <div class="k" style="margin-top:6px;">Est. Profit (USDT)</div>
                  <div class="v good" id="o_tp_pnl">‚Äî</div>
                </div>
              </div>

              <div class="hint" style="margin-top:10px;">
                <b>Interpretasi cepat:</b> Gerak harga (%) √ó leverage = dampak ke margin (%).<br/>
                Contoh: SL 0.3% dan 40x ‚Üí 12% margin.
              </div>
            </div>
          </div>

          <div class="card" style="margin-top:10px;">
            <div class="hd">
              <div class="title">4) Reason / Journal Note (Wajib)</div>
              <div class="seg"><span class="tag warn">Bantu evaluasi & disiplin</span></div>
            </div>
            <div class="bd">
              <label>Reason / alasan entry (setup, TF, S/R, pattern, invalidasi)
                <textarea id="f_note" placeholder="Tulis alasan kamu di sini..."></textarea>
              </label>
            </div>
          </div>

          <div class="seg" style="margin-top:12px;">
            <button id="btnSave" class="primary">Save Trade</button>
            <button id="btnMarkUnset" class="">‚¨ú Belum dinilai</button>
            <button id="btnMarkGood" class="">‚úÖ Analisis benar</button>
            <button id="btnMarkBad" class="">‚ùå Analisis salah</button>
            <button id="btnDelete" class="danger">Delete</button>
          </div>

          <div class="hint" style="margin-top:10px;">
            <b>Status:</b> kamu bisa set manual setelah trade selesai. Statistik pakai status ini.
          </div>
        </div>
      </div>

      <!-- RIGHT: STATS + TABLE -->
      <div class="card">
        <div class="hd">
          <div class="title">Trade Log + Statistik</div>
          <div class="seg">
            <span class="tag">Total: <span id="s_total" class="mono">0</span></span>
            <span class="tag good">‚úÖ <span id="s_win" class="mono">0</span></span>
            <span class="tag bad">‚ùå <span id="s_loss" class="mono">0</span></span>
            <span class="tag warn">Win rate: <span id="s_wr" class="mono">0%</span></span>
          </div>
        </div>

        <div class="bd">
          <div class="kpis">
            <div class="kpi">
              <div class="k">Avg profit impact % (‚úÖ)</div>
              <div class="v good" id="s_ap">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="k">Avg loss impact % (‚ùå)</div>
              <div class="v bad" id="s_al">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="k">Avg RR (TP%/SL%)</div>
              <div class="v warn" id="s_arr">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="k">Quality check</div>
              <div class="v" id="s_qc">‚Äî</div>
            </div>
          </div>

          <div class="row" style="margin-top:10px;">
            <label>Search (pair / note)
              <input id="q" placeholder="e.g. BTC / support / H&S" />
            </label>
            <label>Filter result
              <select id="filter">
                <option value="ALL">All</option>
                <option value="UNSET">‚¨ú Belum dinilai</option>
                <option value="WIN">‚úÖ Benar</option>
                <option value="LOSS">‚ùå Salah</option>
              </select>
            </label>
          </div>

          <div class="tableWrap" style="margin-top:10px;">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Pair</th>
                  <th>Side</th>
                  <th>Entry</th>
                  <th>SL (price + %)</th>
                  <th>TP (price + %)</th>
                  <th>Lev</th>
                  <th>Margin</th>
                  <th>Pos size</th>
                  <th>SL impact %</th>
                  <th>TP impact %</th>
                  <th>Result</th>
                  <th>Note</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>

          <div class="hint" style="margin-top:10px;">
            Kolom impact% 
